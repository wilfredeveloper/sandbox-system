# ===================================================================
# Sandbox Server v2 - Environment Configuration
# ===================================================================
# Copy this file to .env and adjust values for your deployment
# All settings have sensible defaults optimized for AI agent bash execution

# ===================================================================
# Server Configuration
# ===================================================================
PORT=5000
HOST=0.0.0.0
DEBUG=false
WORKER_ID=standalone

# ===================================================================
# Container Pool Configuration
# ===================================================================
# POOL_SIZE: Number of pre-warmed containers ready for instant allocation
# Recommended: 10-20 for AI agent workloads
POOL_SIZE=10

# MIN_POOL_SIZE: Minimum containers to maintain in the pool
# Pool will auto-refill to this size after usage
MIN_POOL_SIZE=3

# MAX_POOL_SIZE: Maximum concurrent containers allowed
# For 24GB RAM with 256MB containers: ~80 theoretical max, 40-60 practical
MAX_POOL_SIZE=80

# ===================================================================
# Container Resource Limits
# ===================================================================
# CONTAINER_IMAGE: Docker image for sandbox containers
CONTAINER_IMAGE=sandbox-secure:latest

# MEMORY_LIMIT: Memory limit per container
# 256m is optimal for AI agent bash commands (ls, cat, python scripts)
# Use 512m for heavier workloads (npm install, pip installs)
MEMORY_LIMIT=256m

# CPU_QUOTA: CPU quota in microseconds per 100ms period
# 25000 = 25% of one core, 50000 = 50%, 100000 = 100%
CPU_QUOTA=25000

# SANDBOX_USER: Non-root user for command execution
SANDBOX_USER=sandboxuser

# WORKSPACE_DIR: Working directory inside container
WORKSPACE_DIR=/workspace

# ===================================================================
# Timeout Configuration
# ===================================================================
# SESSION_TIMEOUT_MINUTES: Maximum session lifetime (from creation)
# After this time, session is expired and cleaned up
# Recommended: 15-30 minutes for AI agent sessions
SESSION_TIMEOUT_MINUTES=15

# CONTAINER_IDLE_TIMEOUT_MINUTES: Idle time before container cleanup
# Containers with no activity for this duration are cleaned up
# Recommended: 5-10 minutes for AI agent workloads
CONTAINER_IDLE_TIMEOUT_MINUTES=5

# CLEANUP_INTERVAL_SECONDS: How often to check for expired/idle sessions
# Recommended: 300 seconds (5 minutes)
CLEANUP_INTERVAL_SECONDS=300

# DEFAULT_COMMAND_TIMEOUT: Default timeout for command execution (seconds)
DEFAULT_COMMAND_TIMEOUT=30

# ===================================================================
# Pool Management Strategy
# ===================================================================
# AGGRESSIVE_CLEANUP: Enable aggressive container cleanup
# true: Destroy containers when pool is adequately sized (saves resources)
# false: Keep containers up to MAX_POOL_SIZE (faster allocation)
# Recommended: true for resource-constrained servers
AGGRESSIVE_CLEANUP=true

# POOL_REFILL_DELAY_SECONDS: Delay before refilling pool after allocation
# Prevents thrashing during burst traffic
POOL_REFILL_DELAY_SECONDS=60

# ===================================================================
# Redis Configuration (for distributed setup)
# ===================================================================
# Leave REDIS_HOST empty for standalone mode
# Set REDIS_HOST to enable distributed session storage
REDIS_HOST=
REDIS_PORT=6379

# ===================================================================
# Docker Configuration
# ===================================================================
# DOCKER_NETWORK_MODE: Network isolation mode
# none: No network access (most secure)
# bridge: Basic networking
# host: Full host network access
DOCKER_NETWORK_MODE=none

# ===================================================================
# File and Workspace Limits
# ===================================================================
# MAX_FILE_SIZE_MB: Maximum size for a single uploaded file (in MB)
# Prevents abuse and resource exhaustion
MAX_FILE_SIZE_MB=100

# MAX_TOTAL_FILES: Maximum number of files allowed in workspace
# Prevents directory listing attacks and resource exhaustion
MAX_TOTAL_FILES=1000

# MAX_WORKSPACE_SIZE_MB: Maximum total workspace size (in MB)
# Prevents disk space exhaustion
MAX_WORKSPACE_SIZE_MB=500

# ===================================================================
# Recommended Configurations by Use Case
# ===================================================================

# --- For 24GB Contabo Server (AI Agent Bash) ---
# POOL_SIZE=20
# MIN_POOL_SIZE=5
# MAX_POOL_SIZE=80
# MEMORY_LIMIT=256m
# CPU_QUOTA=25000
# SESSION_TIMEOUT_MINUTES=15
# CONTAINER_IDLE_TIMEOUT_MINUTES=5
# AGGRESSIVE_CLEANUP=true

# --- For High-Throughput AI Agents (Lots of quick commands) ---
# POOL_SIZE=30
# MIN_POOL_SIZE=10
# MAX_POOL_SIZE=80
# AGGRESSIVE_CLEANUP=false
# (Keep more containers ready)

# --- For Low-Traffic / Resource-Constrained ---
# POOL_SIZE=5
# MIN_POOL_SIZE=2
# MAX_POOL_SIZE=20
# MEMORY_LIMIT=256m
# AGGRESSIVE_CLEANUP=true
# (Minimize resource usage)

# --- For Heavy Workloads (npm install, pip, compilation) ---
# POOL_SIZE=10
# MAX_POOL_SIZE=30
# MEMORY_LIMIT=512m
# CPU_QUOTA=50000
# SESSION_TIMEOUT_MINUTES=30
# (More resources per container, fewer total containers)
